
SELECT  a.tablespace_name,
    ROUND (((c.BYTES - NVL (b.BYTES, 0)) / c.BYTES) * 100,2) percentage_used,
    c.BYTES / 1024 / 1024/1024 space_allocated,
    ROUND (c.BYTES / 1024 / 1024/1024 - NVL (b.BYTES, 0) / 1024 / 1024/1024,2) space_used,
    ROUND (NVL (b.BYTES, 0) / 1024 / 1024/1024, 2) space_free, 
    c.DATAFILES
  FROM dba_tablespaces a,
       (    SELECT   tablespace_name, 
                  SUM (BYTES) BYTES
           FROM   dba_free_space
       GROUP BY   tablespace_name
       ) b,
      (    SELECT   COUNT (1) DATAFILES, 
                  SUM (BYTES) BYTES, 
                  tablespace_name
           FROM   dba_data_files
       GROUP BY   tablespace_name
    ) c
  WHERE b.tablespace_name(+) = a.tablespace_name 
    AND c.tablespace_name(+) = a.tablespace_name
ORDER BY NVL (((c.BYTES - NVL (b.BYTES, 0)) / c.BYTES), 0) DESC;

##cekdatafile
set lines 1200
col file_name for a90
select file_id, FILE_NAME,TABLESPACE_NAME,BYTES/1024/1024,AUTOEXTENSIBLE,MAXBYTES/1024/1024 from dba_data_files where TABLESPACE_NAME='&TABLESPACE_NAME';

##resize datafile
ALTER DATABASE DATAFILE 148 RESIZE 30G;

##Add datafile
ALTER TABLESPACE LC_AMLPHBD_AS5_DATA add DATAFILE '+DATA' SIZE 30G;

alter 



create smallfile tablespace TS_CC_ARC_GL_VM datafile size 10g autoextend on next 100m maxsize 30g;

alter tablespace CC_CCS_ARC add datafile size 10g autoextend on next 100m maxsize 30g;
alter tablespace CC_CCS_ARC add datafile size 10g autoextend on next 100m maxsize 30g;
alter tablespace CC_CCS_ARC add datafile size 10g autoextend on next 100m maxsize 30g;
alter tablespace CC_CCS_ARC add datafile size 10g autoextend on next 100m maxsize 30g;



SELECT  a.tablespace_name,
    ROUND (((c.BYTES - NVL (b.BYTES, 0)) / c.BYTES) * 100,2) percentage_used,
    c.BYTES / 1024 / 1024/1024 space_allocated,
    ROUND (c.BYTES / 1024 / 1024/1024 - NVL (b.BYTES, 0) / 1024 / 1024/1024,2) space_used,
    ROUND (NVL (b.BYTES, 0) / 1024 / 1024/1024, 2) space_free, 
    c.DATAFILES
  FROM dba_tablespaces a,
       (    SELECT   tablespace_name, 
                  SUM (BYTES) BYTES
           FROM   dba_free_space
       GROUP BY   tablespace_name
       ) b,
      (    SELECT   COUNT (1) DATAFILES, 
                  SUM (BYTES) BYTES, 
                  tablespace_name
           FROM   dba_data_files
       GROUP BY   tablespace_name
    ) c
  WHERE b.tablespace_name(+) = a.tablespace_name 
    AND c.tablespace_name(+) = a.tablespace_name
    AND a.tablespace_name='&TBS_NAME'
ORDER BY NVL (((c.BYTES - NVL (b.BYTES, 0)) / c.BYTES), 0) DESC;